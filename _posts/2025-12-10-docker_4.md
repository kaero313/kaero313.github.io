---
title: "[도커-4] CI/CD 자동화: GitHub Actions를 통한 도커 이미지 빌드와 자동 배포"
date: 2025-12-10 13:49:31 +0900
categories: [Infra, Docker]
tags: [도커, 인프라, 서버]
---

<div align="center">
  <img src="assets/img/docker/github_actions.png" alt="깃허브 액션 아이콘" width="500">
</div>

> 아니 도커 얘기중인데 갑자기 깃허브 관련한게 왜 나옴 ?

도커로 애플리케이션을 깔끔하게 컨테이너화하는 것까진 성공했다. 그런데 문득 궁금증이 생겼다.<br/>
"내가 만든 이 이미지를 코드가 바뀔 때마다 자동으로 빌드하고, 서버에 올리는 과정은 어떻게 해야 할까?"<br/>
결국 도커의 궁극적인 목적, 즉 '어디서든 쉽게 실행되는 애플리케이션'을 완성하려면 자동화 파이프라인 구축이 필수적이었다.<br/>
Jenkins, GitLab CI/CD, CircleCI, GitHub Actions등 수 많은 CI/CD 도구가 있었는데,<br/>
여기서는 GitHub Actions를 사용하여 자동화 파이프라인을 구축해보도록 하겠다.<br/>
<br/>
도커가 결과물(이미지)을 담당한다면, 액션은 과정(빌드, 테스트, 배포)을 책임지는 셈이다.<br/>
최종적인 워크 플로우는 아래와 같이 될 것이다.

```tree
1. 개발자가 로컬에서 코드 수정
   ↓
2. 수정 내역 Git Push
   ↓
3. 자동으로 도커 이미지 빌드
   ↓
4. 도커 허브 업로드
```

# 깃허브
---

## 레포지토리 생성

우선 코드를 올릴 수 있는 레포지토리가 필요하다.<br/>
docker_github-actions 라는 이름으로 생성을 하고, 도커와 연동하기 위해<br/>
도커 허브 엑세스 토큰을 발급받아 유저 이름과 함께 해당 레포지토리 secrets에 등록을 했다.<br/>

<div align="left" style="display:flex;">
  <img src="assets/img/docker/dockerhub_token.png" alt="도커 허브 토큰" width="500">
  <img src="assets/img/docker/repo_secrets.png" alt="레포 시크릿" width="500">
</div>

## 깃허브 액션

깃허브 액션의 워크플로우를 정의하고, 사용하기 위해서 반드시 지켜야 하는 규칙은 두 가지이다.
- 레포지토리 최상단에 필수 디렉토리명 지정하여 생성: .github/workflows
- 해당 디렉토리 안의 파일은 yaml, yml 포맷으로 작성

다음은 .github/workflows/docker-build.yml의 내용이다.
```yml
# Workflow 이름
name: Docker Build and Push

# 언제 실행할지 (main 브랜치에 push 시)
on:
  push:
    branches: [ main ]

# 실행할 작업들
jobs:
  build:
    # Ubuntu 최신 버전에서 실행
    runs-on: ubuntu-latest
    
    steps:
      # 1단계: 코드 가져오기
      - name: Checkout code
        uses: actions/checkout@v3
      
      # 2단계: Docker 로그인
      - name: Login to Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_TOKEN }}
      
      # 3단계: Docker 이미지 빌드
      - name: Build Docker image
        run: |
          docker build -t ${{ secrets.DOCKER_USERNAME }}/flask-app:latest ./app
          docker build -t ${{ secrets.DOCKER_USERNAME }}/flask-app:${{ github.sha }} ./app
      
      # 4단계: Docker Hub에 Push
      - name: Push to Docker Hub
        run: |
          docker push ${{ secrets.DOCKER_USERNAME }}/flask-app:latest
          docker push ${{ secrets.DOCKER_USERNAME }}/flask-app:${{ github.sha }}
```

- [깃허브 액션 문서](https://docs.github.com/en/actions/reference/workflows-and-actions/workflow-syntax)

파일은 기본적으로 yaml형식으로 작성하며, 내용은 깃허브 액션에서 정의한 고유의 문법을 따른다.<br/>
정확히 무슨 기능인지는 모르지만 키워드를 보고 유추하기에는 충분하다.
> 모르면 그냥 느껴

<br/>

# 자동화 테스트
---



