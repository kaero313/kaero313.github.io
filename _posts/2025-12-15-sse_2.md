---
title: "[SSE-2] 실시간 알림 서비스 구현해보기 feat. AOP"
date: 2025-12-17 15:41:10 +0900
categories: [Web, Server]
tags: [웹, 서버]
preview_image: assets/img/sse/prev_icon.png 
---

실시간 알림 서비스를 구현하기 위하여 세팅된 프로젝트 환경은 이와 같다.
- Spring Boot
- Spring Security
- Java21
- Mybatis

# SSE 구현
---

## 디렉토리 구성

우선 현재 프로젝트 환경에 맞춰서 디렉토리를 구성했다.
```tree
sse-project/
├── java/
│   ├── config/
│   │   └── SecurityConfig.java # 스프링 시큐리티 설정 파일
│   ├── sse/
│   │   ├── SseController.java # 컨트롤러
│   │   ├── SseService.java # 서비스
│   │   └── SseMapper.java # 매퍼
│   ├── noti/
│   │   ├── Notification.java # 알림 DTO
│   │   ├── NotifyChange.java # 커스텀 어노테이션
│   │   └── NotifyChangeAspect.java # AOP
│   │
│   resources/
│   ├── mapper/
│   │   └── SseMapper.xml # 매퍼
│   ├── thymeleaf/
│   │   └── sse.html # 알림 수신 페이지
│   ├── js/
│   │   └── sse.js # 연결 스크립트
└ pom.xml # Maven 관리
```
> 실제 프로젝트와 동일한 구성은 아니고 대략적으로 필요한 파일만 간추렸다.

## 1. 백앤드
---

### security 설정

기본적으로 스프링 시큐리티는 애플리케이션으로 들어오는 모든 종류의 요청을 감지하기 때문에,<br/>
sse api를 만들기 위해서는 해당 요청에 대한 권한 처리를 하는 설정이 필요했다.<br/>

<div align="left">
  <img src="assets/img/sse/security_config.png" alt="시큐리티 설정" width="800">
</div>

- 테스트를 위해 기본적인 설정들은 비활성화하고, api 요청은 허용하도록 설정했다.

### 컨트롤러

<div align="left" style="display:flex;">
  <img src="assets/img/sse/SseController1.png" alt="컨트롤러1" width="500">
  <img src="assets/img/sse/SseController2.png" alt="컨트롤러2" width="500">
  <img src="assets/img/sse/SseController3.png" alt="컨트롤러3" width="500">
</div>
> 클라이언트는 로그인 시 /api/sse/stream 으로 요청하여 연결을 해놔야한다.

## 서비스

<div align="left" style="display:flex;">
  <img src="assets/img/sse/SseService1.png" alt="서비스1" width="500">
  <img src="assets/img/sse/SseService2.png" alt="서비스2" width="500">
  <img src="assets/img/sse/SseService3.png" alt="서비스3" width="500">
</div>
> 멀티스레드 환경을 고려해서 정상적으로 서비스 될 수 있도록 구성했다.

## DTO

<div align="left">
  <img src="assets/img/sse/notification.png" alt="DTO" width="500">
</div>

## 커스텀 어노테이션

<div align="left">
  <img src="assets/img/sse/notifychange.png" alt="notifychange" width="500">
</div>
> 커스텀 어노테이션. 메소드에서 어노테이션으로 사용할 수 있다.

## AOP

<div align="left" style="display:flex;">
  <img src="assets/img/sse/notifychangeaspect1.png" alt="notifychangeaspect1" width="500">
  <img src="assets/img/sse/notifychangeaspect2.png" alt="notifychangeaspect2" width="500">
</div>
> AOP 클래스. 어노테이션을 기반으로 한 AOP 구현체이다.

- AOP 클래스 용어 설명

| 용어 | 설명 | 코드 내 역할 |
| :--- | :--- | :--- |
| @Aspect | 클래스가 공통 관심사(알림 전송)를 처리하는 클래스임을 선언한다. | '알림 전송 로직은 여기서 처리한다'는 선언을 담당한다. |
| @AfterReturning | Advice(시점)의 한 종류로, 타겟 메서드가 성공적으로 실행을 마친 후에만 동작한다. | 메서드가 에러 없이 끝났을 때만 알림을 보내도록 한다. |
| pointcut | 어디에 이 로직을 적용할지 정하는 규칙이다. | @NotifyChange가 붙은 메서드들만 골라내는 기준이 된다. |
| returning | 타겟 메서드가 반환한 결과값을 어떤 파라미터로 받을지 지정한다. | 메서드 실행 결과(result)를 가져와서 알림 내용에 활용한다. |
| JoinPoint | 실행 시점의 모든 정보(메서드 이름, 파라미터 등)를 담고 있는 객체이다. | 실행된 메서드가 무엇인지, 어떤 파라미터가 들어왔는지 확인한다. |
| MethodSignature | JoinPoint에서 추출한 정보로, 메서드의 신분증 같은 정보이다. | 실행된 메서드에서 @NotifyChange 애노테이션 정보를 읽기 위해 사용한다. |

알림 전송이 발생해야하는 메소드에 @NotifyChange 어노테이션을 붙인 뒤 해당 메소드가 성공적으로 실행을 마치면,<br/>알림을 보내는 메소드인 afterNotifyChange가 실행된다.

## 매퍼

<div align="left" style="display:flex;">
  <img src="assets/img/sse/ssemapper1.png" alt="ssemapper1" width="500">
  <img src="assets/img/sse/ssemapper2.png" alt="ssemapper2" width="500">
</div>

프로세스를 삽입하는 쿼리에 커스텀 어노테이션인 NotifyChange를 사용하면 해당 쿼리를 사용하는 모든 서비스에서 자동으로 알림이 전송된다.


